<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>VR Tour Debug Mode</title>
  <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
  <script src="https://unpkg.com/aframe-look-at-component@0.8.0/dist/aframe-look-at-component.min.js"></script>
  <style>
    body { margin: 0; font-family: sans-serif; }
  </style>
</head>
<body>

<a-scene background="color: #000">
  <a-entity id="cameraRig">
    <a-entity id="camera" camera look-controls wasd-controls position="0 1.6 0">
      <a-entity
        cursor="fuse: true; fuseTimeout: 800"
        raycaster="objects: .clickable"
        position="0 0 -0.5"
        geometry="primitive: ring; radiusInner: 0.01; radiusOuter: 0.02"
        material="color: white; shader: flat">
      </a-entity>
    </a-entity>
    <a-entity laser-controls="hand: right"></a-entity>
  </a-entity>

  <a-sky id="sky" radius="5000" src="" rotation="0 -90 0"></a-sky>
  <a-entity id="hotspots"></a-entity>
</a-scene>

<script>
const SCENES = [
  { id: "living", name: "Living Room", src: "Living_Room.jpg",
    hotspots: [
      { label: "To Kitchen", target: "kitchen", yaw: 45, pitch: 0 },
      { label: "To Reception", target: "reception", yaw: -45, pitch: 0 },
      { label: "To Corridor", target: "corridor", yaw: 135, pitch: 0 }
    ]
  },
  { id: "kitchen", name: "Kitchen", src: "Kitchen.jpg",
    hotspots: [
      { label: "To Living Room", target: "living", yaw: -90, pitch: 0 }
    ]
  },
  { id: "reception", name: "Reception", src: "Reception.jpg",
    hotspots: [
      { label: "To Living Room", target: "living", yaw: 90, pitch: 0 }
    ]
  },
  { id: "corridor", name: "Corridor", src: "Corridor.jpg",
    hotspots: [
      { label: "To Bathroom", target: "bathroom", yaw: 45, pitch: 0 },
      { label: "To Bedroom", target: "bedroom", yaw: -45, pitch: 0 },
      { label: "To Living Room", target: "living", yaw: 180, pitch: 0 }
    ]
  },
  { id: "bathroom", name: "Bathroom", src: "Bathroom.jpg",
    hotspots: [
      { label: "To Corridor", target: "corridor", yaw: 180, pitch: 0 }
    ]
  },
  { id: "bedroom", name: "Bedroom", src: "Bedroom.jpg",
    hotspots: [
      { label: "To Corridor", target: "corridor", yaw: 0, pitch: 0 }
    ]
  }
];

let currentScene = "living";

function degToRad(d) { return d * Math.PI / 180; }
function sphToCartesian(yawDeg, pitchDeg, r=3.5) {
  const yaw = degToRad(yawDeg);
  const pitch = degToRad(pitchDeg);
  const x = r * Math.cos(pitch) * Math.sin(yaw);
  const y = r * Math.sin(pitch);
  const z = -r * Math.cos(pitch) * Math.cos(yaw);
  return { x, y, z };
}

const sky = document.getElementById('sky');
const hotspotsContainer = document.getElementById('hotspots');

function clearHotspots() {
  while (hotspotsContainer.firstChild) hotspotsContainer.removeChild(hotspotsContainer.firstChild);
}

function goToScene(targetId) {
  console.log(`ðŸ” Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ø¥Ù„Ù‰ Ø§Ù„Ù…Ø´Ù‡Ø¯: ${targetId}`);
  const targetScene = SCENES.find(scene => scene.id === targetId);

  if (!targetScene) {
    console.error(`âŒ Ø§Ù„Ù…Ø´Ù‡Ø¯ "${targetId}" ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ SCENES`);
    return;
  }

  fetch(targetScene.src)
    .then(response => {
      if (!response.ok) throw new Error(`âŒ ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø©: ${targetScene.src}`);
      console.log(`âœ… ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„ØµÙˆØ±Ø©: ${targetScene.src}`);
      loadScene(targetId);
    })
    .catch(err => {
      console.error(err.message);
    });
}

function createHotspot(h) {
  const pos = sphToCartesian(h.yaw, h.pitch, 3.5);
  const wrapper = document.createElement('a-entity');
  wrapper.setAttribute('class', 'clickable');
  wrapper.setAttribute('position', `${pos.x} ${pos.y} ${pos.z}`);
  wrapper.setAttribute('look-at', '#camera');

  const sphere = document.createElement('a-sphere');
  sphere.setAttribute('radius', '0.15');
  sphere.setAttribute('color', '#00f');
  sphere.setAttribute('emissive', '#0ff');
  sphere.setAttribute('material', 'shader: flat; opacity: 0.9;');
  sphere.setAttribute('animation', 'property: scale; dir: alternate; dur: 1000; loop: true; to: 1.3 1.3 1.3');

  const label = document.createElement('a-entity');
  label.setAttribute('geometry', 'primitive: plane; height: 0.25; width: 1.5');
  label.setAttribute('material', 'color: rgba(0,0,0,0.6); shader: flat;');
  label.setAttribute('position', '0 0.35 0');
  label.setAttribute('text', `value: ${h.label}; align: center; width: 2; color: #fff;`);

  wrapper.appendChild(sphere);
  wrapper.appendChild(label);
  wrapper.addEventListener('click', () => goToScene(h.target));

  return wrapper;
}

function loadScene(sceneId) {
  const scene = SCENES.find(s => s.id === sceneId);
  if (!scene) return;
  sky.setAttribute('src', scene.src);
  clearHotspots();
  scene.hotspots.forEach(h => hotspotsContainer.appendChild(createHotspot(h)));
  currentScene = scene.id;
}

window.onload = () => {
  loadScene(currentScene);
};
</script>

</body>
</html>
